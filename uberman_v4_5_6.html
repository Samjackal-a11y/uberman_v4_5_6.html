<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Uberman v4.5.6 â€” Debugging Milestone Dashboard</title>
  <style>
    body { background: black; margin: 0; font-family: monospace; color: #ccc; }
    canvas { display: block; }
    h3 { margin-top: 0; }
    .overlay {
      position: fixed; background: rgba(0,0,0,0.85);
      border: 1px solid #333; padding: 12px;
      font-size: 13px; z-index: 20;
    }
    button { background:#111; color:#9f9; border:1px solid #333; padding:6px 10px; margin:2px; cursor:pointer; }
    button:hover { background:#0a0a0a; }
    .commit-card {
      background: #fff; color:#000; margin-bottom: 1em; padding: 1em 1.2em;
      border-radius: 7px; box-shadow: 0 2px 5px rgba(0,0,0,0.08);
    }
    .commit-message { font-size: 1.1em; margin: 0 0 .5em 0; }
    .commit-meta { font-size: .95em; color: #555; margin-bottom: .4em; }
    a.button { background: #24292f; color: white; padding: 0.4em 0.9em; text-decoration: none; border-radius: 4px;}
    a.button:hover { background: #444; }
  </style>
</head>
<body>

  <!-- Matrix Rain -->
  <canvas id="matrixCanvas"></canvas>

  <!-- ConstellationView -->
  <div id="constellationView" class="overlay" style="top:60px; left:50%; transform:translateX(-50%); width:800px; height:500px; display:none;">
    <h3 style="color:#cc99ff;">ConstellationView â€” Meaning Map</h3>
    <canvas id="constellationCanvas" width="760" height="440" style="background:#111;"></canvas>
  </div>

  <!-- Commit Viewer -->
  <div id="commitView" class="overlay" style="bottom:20px; left:20px; width:600px; height:300px; overflow-y:scroll; display:none; background:#f5f5f5; color:#000;">
    <h3 style="color:#000;">Recent Commits for <code>uberman_v4_5_6.html</code></h3>
    <div id="commits">Loading...</div>
  </div>

  <!-- DebugView -->
  <div id="debugView" class="overlay" style="top:100px; left:50%; transform:translateX(-50%); width:600px; height:300px; overflow-y:scroll; display:none; background:#222; color:#9f9;">
    <h3 style="color:#ff6666;">DebugView â€” Fault & Performance Log</h3>
    <div id="debugEntries"></div>
  </div>

  <!-- Toggle Buttons -->
  <div id="viewToggle" style="position:fixed; top:20px; left:20px; z-index:30;">
    <button onclick="showMatrix()">Matrix Rain</button>
    <button onclick="showConstellation()">Constellation Dashboard</button>
    <button onclick="toggleOverlay('commitView')">Commit Viewer</button>
    <button onclick="toggleOverlay('debugView')">DebugView</button>
  </div>

  <!-- Slider Panel -->
  <div id="sliderPanel" style="position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:#111; border:1px solid #333; padding:10px; z-index:30;">
    <label style="color:#9f9;">Emotion:</label>
    <input type="range" id="emotionSlider" min="0.5" max="1.5" step="0.01" value="0.85">
    <span id="emotionValue" style="color:#9f9;">0.85</span>
    <br>
    <label style="color:#9f9;">Curiosity:</label>
    <input type="range" id="curiositySlider" min="0.5" max="1.5" step="0.01" value="0.90">
    <span id="curiosityValue" style="color:#9f9;">0.90</span>
    <br>
    <button onclick="recordEvolution('v4.5.6-slider', getCurrentDrivers(), 'Testing slider values', 'debug')">Log Sliders</button>
  </div>

  <!-- Ethics Footer -->
  <div style="position:fixed; bottom:5px; right:10px; font-size:12px; z-index:40;">
    <a href="https://sites.google.com/view/uberman-blueprint--ethics/license-ethics" target="_blank" style="color:#9f9; text-decoration:none;">
      ðŸ“œ Ethics & License
    </a>
  </div>

  <script>
    "use strict";

    // Overlay toggle
    function toggleOverlay(id) {
      const el = document.getElementById(id);
      if(!el) return;
      el.style.display = (el.style.display === 'none') ? 'block' : 'none';
    }

    // Slider listeners
    const emotionSlider = document.getElementById('emotionSlider');
    const curiositySlider = document.getElementById('curiositySlider');
    emotionSlider.addEventListener('input', () => {
      document.getElementById('emotionValue').textContent = parseFloat(emotionSlider.value).toFixed(2);
    });
    curiositySlider.addEventListener('input', () => {
      document.getElementById('curiosityValue').textContent = parseFloat(curiositySlider.value).toFixed(2);
    });

    // Helper to get current slider values
    function getCurrentDrivers() {
      return {
        emotion: parseFloat(emotionSlider.value),
        curiosity: parseFloat(curiositySlider.value)
      };
    }

    // Evolution logging
    function recordEvolution(version, drivers, notes, category="technical") {
      const entry = {
        version,
        time: new Date().toISOString(),
        emotion: drivers.emotion,
        curiosity: drivers.curiosity,
        notes,
        category
      };
      console.log("Logged:", entry);
      recordDebug("Evolution", notes);
    }

    // Debug logging
    const debugLog = [];
    function recordDebug(type, message, duration=null) {
      const entry = {
        time: new Date().toLocaleTimeString(),
        type,
        message,
        duration
      };
      debugLog.push(entry);
      renderDebugView();
    }
    function renderDebugView() {
      const d = document.getElementById('debugEntries');
      d.innerHTML = "";
      debugLog.forEach(e => {
        d.innerHTML += `<div style="margin-bottom:6px;">
          <strong>[${e.time}] ${e.type}</strong><br>
          ${e.message}${e.duration ? ` â€” ${e.duration}ms` : ""}
          <hr></div>`;
      });
    }

    // Error & performance hooks
    window.addEventListener("error", e => {
      recordDebug("Error", e.message);
    });
    document.addEventListener("visibilitychange", () => {
      recordDebug("VisibilityChange", "Page visibility toggled");
    });

    // Performance-safe animation loop
    const matrixCanvas = document.getElementById('matrixCanvas');
    const ctx = matrixCanvas.getContext('2d');
    matrixCanvas.width = window.innerWidth;
    matrixCanvas.height = window.innerHeight;

    function drawMatrix() {
      const start = performance.now();
      ctx.fillStyle = "rgba(0,0,0,0.1)";
      ctx.fillRect(0,0,matrixCanvas.width,matrixCanvas.height);
      // ... your matrix rain drawing logic here ...
      const duration = performance.now() - start;
      recordDebug("RAF", "Frame executed", duration.toFixed(2));
      requestAnimationFrame(drawMatrix);
    }
    drawMatrix();

    // Matrix â†” Constellation toggles
    function showMatrix() {
      matrixCanvas.style.display = 'block';
      document.getElementById('constellationView').style.display = 'none';
    }
    function showConstellation() {
      matrixCanvas.style.display = 'none';
      document.getElementById('constellationView').style.display = 'block';
    }

    // Commit Viewer fetch
    fetch('https://api.github.com/repos/Samjackal-a11y/uberman-matrix-view2/commits?path=uberman_v4_5_6.html&per_page=5')
      .then(response => response.json())
      .then(commits => {
        document.getElementById('commits').innerHTML = commits.map(commit => `
          <div class="commit-card">
            <div class="commit-message">${
